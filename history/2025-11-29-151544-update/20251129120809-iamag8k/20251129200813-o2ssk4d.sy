{"ID":"20251129200813-o2ssk4d","Spec":"1","Type":"NodeDocument","Properties":{"id":"20251129200813-o2ssk4d","title":"基础环境搭建","type":"doc","updated":"20251129231332"},"Children":[{"ID":"20251129120813-k29tb5p","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251129120813-k29tb5p","updated":"20251129201312"},"Children":[{"Type":"NodeText","Data":"yolov8m pt文件下载"}]},{"ID":"20251129200855-mhukk4t","Type":"NodeParagraph","Properties":{"id":"20251129200855-mhukk4t","updated":"20251129201027"},"Children":[{"Type":"NodeText","Data":"在此网站内下载权重文件，https://github.com/ultralytics/assets/releases"}]},{"ID":"20251129201312-ezjcfjb","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251129201312-ezjcfjb","updated":"20251129201412"},"Children":[{"Type":"NodeText","Data":"ultralytics下载"}]},{"ID":"20251129201337-lxuylby","Type":"NodeParagraph","Properties":{"id":"20251129201337-lxuylby","updated":"20251129201412"},"Children":[{"Type":"NodeText","Data":"git clone https://github.com/ultralytics/ultralytics.git"}]},{"ID":"20251129200847-2lqspzh","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251129200847-2lqspzh","updated":"20251129214416"},"Children":[{"Type":"NodeText","Data":"linux安装conda"}]},{"ID":"20251129201113-prb0dms","Type":"NodeParagraph","Properties":{"id":"20251129201113-prb0dms","updated":"20251129201113"},"Children":[{"Type":"NodeText","Data":"curl -O https://repo.anaconda.com/archive/Anaconda3-\u003cINSTALLER_VERSION\u003e-Linux-x86_64.sh"}]},{"ID":"20251129214416-3248wey","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251129214416-3248wey","updated":"20251129214426"},"Children":[{"Type":"NodeText","Data":"yolo部署安装"}]},{"ID":"20251129201115-i3qcmre","Type":"NodeParagraph","Properties":{"id":"20251129201115-i3qcmre","updated":"20251129201233"},"Children":[{"Type":"NodeText","Data":"conda create -n yolov8 python=3.8"}]},{"ID":"20251129201216-duszd4t","Type":"NodeParagraph","Properties":{"id":"20251129201216-duszd4t","updated":"20251129201300"},"Children":[{"Type":"NodeText","Data":"conda activate yolov8"}]},{"ID":"20251129201431-x3z14f7","Type":"NodeParagraph","Properties":{"id":"20251129201431-x3z14f7","updated":"20251129201441"},"Children":[{"Type":"NodeText","Data":"cd ultralytics"}]},{"ID":"20251129201301-n1gya1g","Type":"NodeParagraph","Properties":{"id":"20251129201301-n1gya1g","updated":"20251129201430"},"Children":[{"Type":"NodeText","Data":"pip install -e . --index-url https://pypi.org/simple"}]},{"ID":"20251129202056-8kp71x0","Type":"NodeParagraph","Properties":{"id":"20251129202056-8kp71x0","updated":"20251129202254"},"Children":[{"Type":"NodeText","Data":"vim /root/ultralytics/ultralytics/cfg/default.yaml设置model位置，data设置为coco128.yaml"}]},{"ID":"20251129214334-8skp70a","Type":"NodeParagraph","Properties":{"id":"20251129214334-8skp70a","updated":"20251129214345"},"Children":[{"Type":"NodeText","Data":"yolo export model=yolov8m.pt format=onnx"}]},{"ID":"20251129214334-jazocp8","Type":"NodeParagraph","Properties":{"id":"20251129214334-jazocp8","updated":"20251129214401"},"Children":[{"Type":"NodeText","Data":"根据实际情况安装缺少的依赖，pip install --extra-index-url https://pypi.org/simple/ onnxslim==0.1.71"}]},{"ID":"20251129201036-p2l273n","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251129201036-p2l273n","updated":"20251129231332"},"Children":[{"Type":"NodeText","Data":"将onnx转换为rknn"}]},{"ID":"20251129214501-3v8fr40","Type":"NodeParagraph","Properties":{"id":"20251129214501-3v8fr40","updated":"20251129214841"},"Children":[{"Type":"NodeText","Data":"git clone https://github.com/airockchip/rknn-toolkit2.git"}]},{"ID":"20251129214842-67ov20l","Type":"NodeParagraph","Properties":{"id":"20251129214842-67ov20l","updated":"20251129215848"},"Children":[{"Type":"NodeText","Data":"pip install -r requirements_cp38-2.3.2.txt -i https://mirrors.aliyun.com/pypi/simple"}]},{"ID":"20251129215850-wnq651h","Type":"NodeParagraph","Properties":{"id":"20251129215850-wnq651h","updated":"20251129223540"},"Children":[{"Type":"NodeText","Data":"pip install rknn_toolkit2-2.3.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl"}]},{"ID":"20251129223550-4383qi5","Type":"NodeParagraph","Properties":{"id":"20251129223550-4383qi5","updated":"20251129231318"},"Children":[{"Type":"NodeText","Data":"创建转换脚本:"}]},{"ID":"20251129231308-o3mdjes","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251129231308-o3mdjes","updated":"20251129231332"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"import os\nimport sys\nfrom rknn.api import RKNN\n\n# --- 配置参数 ---\n# 目标平台：RK3576\nTARGET_PLATFORM = 'rk3576'\n# ONNX 模型文件路径\nONNX_MODEL_PATH = 'yolov8m.onnx'\n# 导出的 RKNN 模型文件路径\nRKNN_MODEL_PATH = 'yolov8m_rk3576.rknn'\n# YOLOv8m 的输入尺寸 (Batch=1, Channels=3, Height=640, Width=640)\nINPUT_SIZE = [1, 3, 640, 640]\n\n# --- YOLOv8 模型配置 ---\n# YOLOv8 模型通常使用 [0, 0, 0] 和 [255, 255, 255] 进行归一化\n# (即：input = (input - mean) / std)\nMEAN_VALUES = [[0, 0, 0]]\nSTD_VALUES = [[255, 255, 255]]\n# 通道顺序配置 (通常保持 0 1 2)\nREORDER_CHANNEL = '0 1 2' \n\ndef convert_model():\n    # 检查 ONNX 文件是否存在\n    if not os.path.exists(ONNX_MODEL_PATH):\n        print(f\"错误: 找不到 ONNX 模型文件 {ONNX_MODEL_PATH}\")\n        sys.exit(1)\n    \n    # 创建 RKNN 对象\n    rknn = RKNN(verbose=True)\n\n    try:\n        # 1. 配置模型参数\n        print(f'\u003e\u003e\u003e 1. 配置模型参数，目标平台: {TARGET_PLATFORM}')\n        rknn.config(\n            target_platform=TARGET_PLATFORM,\n            mean_values=MEAN_VALUES,\n            std_values=STD_VALUES\n        )\n\n        # 2. 加载 ONNX 模型\n        # 请根据您的 ONNX 模型确定输入张量的名称，YOLO 通常是 'images'\n        print(f'\u003e\u003e\u003e 2. 正在加载 ONNX 模型: {ONNX_MODEL_PATH}')\n        ret = rknn.load_onnx(\n            model=ONNX_MODEL_PATH,\n            inputs=['images'], \n            input_size_list=[INPUT_SIZE]\n        )\n        if ret != 0:\n            print('--- 错误: 加载 ONNX 模型失败! ---')\n            return ret\n\n        # 3. 编译模型\n        # do_quantization=True: 启用 INT8 量化 (性能高，精度可能略有损失)\n        # 第一次尝试建议设置为 False (FP16 或 BFP16 编译)，确保流程正确\n        print('\u003e\u003e\u003e 3. 正在编译模型 (FP16)...')\n        ret = rknn.build(do_quantization=False) \n        if ret != 0:\n            print('--- 错误: 编译模型失败! ---')\n            return ret\n\n        # 4. 导出 RKNN 模型文件\n        print(f'\u003e\u003e\u003e 4. 导出 RKNN 模型文件: {RKNN_MODEL_PATH}')\n        ret = rknn.export_rknn(RKNN_MODEL_PATH)\n        if ret != 0:\n            print('--- 错误: 导出 RKNN 模型失败! ---')\n            return ret\n\n        print('\\n✅ 模型转换和导出成功!')\n        return 0\n\n    finally:\n        # 释放 RKNN 资源\n        rknn.release()\n\nif __name__ == '__main__':\n    convert_model()\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251129200844-r4ggqg6","Type":"NodeParagraph","Properties":{"id":"20251129200844-r4ggqg6","updated":"20251129200844"}},{"ID":"20251129200838-lyck8q6","Type":"NodeParagraph","Properties":{"id":"20251129200838-lyck8q6","updated":"20251129200838"}}]}